<!DOCTYPE html>
<html lang="en">
<head>
  <title>App</title>
  <script type="application/javascript" src="https://accounts.google.com/gsi/client"></script>
</head>
<body>
  <button id="btn-login">Authorize me</button>
  <script type="application/javascript">
    document.addEventListener('DOMContentLoaded', () => {
      let path, result;
      const client = google.accounts.oauth2.initTokenClient({
        client_id: '169826553548-c1o8b8sh7f25qlv1qt026kieucus8r72.apps.googleusercontent.com',
        scope: 'https://www.googleapis.com/auth/userinfo.profile \
                https://www.googleapis.com/auth/userinfo.email',
        callback: async function(response) {
          document.write('<pre></pre>')

          let scriptId = 'AKfycbzotrmQHDOuz9YLFcUwtHCdNvQvAxFH2Bvf7D0bceSCnO486cwibGiusx69WT7Cwi5g1A'
          if (window.scriptId)
            scriptId = window.scriptId
          result = await fetch(`https://script.googleapis.com/v1/scripts/${scriptId}:run`, {
            method: 'POST', headers: { Authorization: `Bearer ${response.access_token}` },
            body: JSON.stringify({
              ...(window.devMode && { devMode: true }),
              function: '$api',
              parameters: [{
                method: 'GET',
                path: '/users/@me',
                headers: { Authorization: `Bearer ${response.access_token}` } }], }) })
          document.querySelector('pre').innerHTML += JSON.stringify(await result.json(), null, 4) + '\n\n'

          path = `/v1/people/me?personFields=photos`
          result = await fetch(`https://people.googleapis.com${path}`, {
            method: 'GET', headers: { Authorization: `Bearer ${response.access_token}` } })
          document.querySelector('pre').innerHTML += JSON.stringify(await result.json(), null, 4) + '\n\n'
        },
      })
      document.querySelector('button#btn-login').addEventListener('click', () => {
        client.requestAccessToken() })
    })
  </script>
</body>
</html>

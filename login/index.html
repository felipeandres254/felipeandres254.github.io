<!DOCTYPE html>
<html lang="en">
<head>
  <title>App</title>
  <script type="application/javascript" src="https://accounts.google.com/gsi/client"></script>
</head>
<body>
  <script type="application/javascript">
    document.addEventListener('DOMContentLoaded', () => {
      window.authorize = function(scope, scriptId, function_name, body, devMode) {
        google.accounts.oauth2.initTokenClient({
          client_id: '169826553548-c1o8b8sh7f25qlv1qt026kieucus8r72.apps.googleusercontent.com',
          scope: scope.join(' '), callback: async function(response) {
            document.write('<pre></pre>')
            body.headers = Object.assign(body.headers || {}, {
              Authorization: `Bearer ${response.access_token}` })
            result = await fetch(`https://script.googleapis.com/v1/scripts/${scriptId}:run`, {
              method: 'POST', headers: { Authorization: `Bearer ${response.access_token}` },
              body: JSON.stringify({
                ...(!!devMode && { devMode: true }),
                function: function_name,
                parameters: [body], }) })
            document.querySelector('pre').innerHTML += JSON.stringify(await result.json(), null, 4) + '\n\n'

            path = `/v1/people/me?personFields=photos`
            result = await fetch(`https://people.googleapis.com${path}`, {
              method: 'GET', headers: { Authorization: `Bearer ${response.access_token}` } })
            document.querySelector('pre').innerHTML += JSON.stringify(await result.json(), null, 4) + '\n\n'
          }
        }).requestAccessToken()
      }
    })
  </script>
</body>
</html>
